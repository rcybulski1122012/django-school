{% extends "base.html" %}

{% block title %}
  {{ student.full_name }} attendance
{% endblock %}

{% block content %}
  <h1>{{ student.full_name }} attendance {% if subject %}| Subject: {{ subject.name }}{% endif %}</h1>

  <div class="row">
    <div class="col-9">
      <canvas id="attendanceChart"></canvas>
    </div>
    <div class="col-3">
      <table class="table table-boarded">
        <thead>
          <tr><th>Status</th><th>Hours</th><th>Percentage</th></tr>
        </thead>
        <tbody>
{#        {# widthratio -> trick to divide two numbers in template  #}
          <tr><td>Present</td><td>{{ statuses.present }}</td><td>{% widthratio statuses.present total 100 %}%</td></tr>
          <tr><td>Absent</td><td>{{ statuses.absent }}</td><td>{% widthratio statuses.absent total 100 %}%</td></tr>
          <tr><td>Exempt</td><td>{{ statuses.exempt }}</td><td>{% widthratio statuses.exempt total 100 %}%</td></tr>
          <tr><td>Excused</td><td>{{ statuses.excused }}</td><td>{% widthratio statuses.excused total 100 %}%</td></tr>
          <tr><td>Total</td><td>{{ total }}</td><td></td></tr>
        </tbody>
      </table>

      <table class="table table-boarded">
        <thead>
          <tr><th>Filter by subjects</th></tr>
        </thead>
        <tbody>
          {% for subject_name in subjects %}
            <tr>
              <td><a href="#" class="text-decoration-none" hx-target="body" hx-swap="outerHTML" hx-get="{{ student.attendance_url }}?subject={{ subject_name }}">
                {{ subject_name }}
              </a></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}

{% block js %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/htmx.org@1.5.0"
          integrity="sha384-oGA+prIp5Vchu6we2YkI51UtVzN9Jpx2Z7PnR1I78PnZlN8LkrCT4lqqqmDkyrvI"
          crossorigin="anonymous"></script>

  <script>
  const data = {
      labels: ['Present', 'Absent', 'Exempt', 'Excused'],
      datasets: [{
          data: [{{ statuses.present }}, {{ statuses.absent }}, {{ statuses.exempt }}, {{ statuses.excused }}],
          backgroundColor: [
              'rgb(11, 212, 0)',
              'rgb(212, 0, 11)',
              'rgb(255, 230, 0)',
              'rgb(28, 149, 255)',
          ]
      }]
  }

  const myChart = new Chart(
      document.getElementById('attendanceChart'),
      {
          type: 'pie',
          data: data
      }
  );

</script>
{% endblock %}
